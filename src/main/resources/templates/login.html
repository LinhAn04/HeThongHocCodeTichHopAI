<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Đăng nhập - Hệ thống học code AI</title>
    <link rel="stylesheet" th:href="@{/css/login.css}">
</head>
<body class="login-page">

<div class="login-wrapper d-flex align-items-center justify-content-center">
    <div class="login-card text-white">

        <h1 class="login-title mb-2">Sign in</h1>
        <p class="mb-4">
            Don’t have an account?
            <a th:href="@{/register}" class="sign-up-link">
                Sign up
            </a>
        </p>

        <form th:action="@{/api/auth/login}" method="post" autocomplete="off"
              onsubmit="return validateLoginForm(event)">

            <!-- Email -->
            <div class="mb-3">
                <input type="text"
                       id="email"
                       name="email"
                       class="form-control form-control-custom"
                       placeholder="Email address"
                       autocomplete="new-password">
            </div>

            <!-- Password + eye icon -->
            <div class="mb-3 position-relative password-wrapper">
                <input type="password"
                       id="password"
                       name="password"
                       class="form-control form-control-custom"
                       placeholder="Password"
                       autocomplete="new-password">
                <span class="toggle-password" id="togglePassword">
                    <img src="/images/eye_hidepass.png" alt="Toggle password">
                </span>
            </div>

            <div class="mb-3">
                <div class="text-end">
                    <a th:href="@{/forgot-password}" class="forgot-pass-link">
                        Forgot password?
                    </a>
                </div>
            </div>

            <!-- Thông báo lỗi -->
            <div id="login-error-popup"
                 class="login-error-popup"
                 th:classappend="${error != null or message != null} ? '' : ' hidden'">

                <span th:text="${error != null ? error : message}" ></span>

                <span th:if="${unverifiedEmail != null}">
                    <a th:href="@{'/api/auth/resend-verify'(email=${unverifiedEmail})}"
                       style="color:#990000; text-decoration: underline; cursor:pointer;">
                        Receive verify code to activate your account.
                    </a>
                </span>

            </div>

            <button type="submit" class="btn-sign-in">
                Sign in
            </button>
        </form>
    </div>
</div>

<script>
    // Toggle show/hide password
    const togglePassword = document.getElementById('togglePassword');
    const passwordInput = document.getElementById('password');

    togglePassword.addEventListener('click', () => {
        const isHidden = passwordInput.getAttribute('type') === 'password';

        // Đổi type input
        passwordInput.setAttribute('type', isHidden ? 'text' : 'password');

        // Đổi icon
        const img = togglePassword.querySelector('img');
        img.src = isHidden ? '/images/eye_seepass.png' : '/images/eye_hidepass.png';
    });

    // Validate
    function showError(msg) {
        const popup = document.getElementById("login-error-popup");
        popup.textContent = msg;
        popup.classList.remove("hidden");
    }

    function hideError() {
        const popup = document.getElementById("login-error-popup");
        popup.classList.add("hidden");
    }

    function validateLoginForm(event) {
        const email = document.getElementById("email");
        const password = document.getElementById("password");

        // Reset lỗi
        email.classList.remove("error-field");
        password.classList.remove("error-field");
        hideError();

        // FE validation
        if (!email.value.trim()) {
            email.classList.add("error-field");
            showError("Email cannot be empty.");
            event.preventDefault();
            return false;
        }

        if (!email.value.includes("@")) {
            email.classList.add("error-field");
            showError("Invalid email format.");
            event.preventDefault();
            return false;
        }

        if (!password.value.trim()) {
            password.classList.add("error-field");
            showError("Password cannot be empty.");
            event.preventDefault();
            return false;
        }

        return true; // OK -> BE xử lý
    }

    // Khi người dùng nhập vào -> ẩn tất cả lỗi
    document.querySelectorAll("input").forEach(input => {
        input.addEventListener("input", () => {
            input.classList.remove("error-field");
            hideError();
        });
    });

</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-whatever"
        crossorigin="anonymous"></script>

</body>
</html>