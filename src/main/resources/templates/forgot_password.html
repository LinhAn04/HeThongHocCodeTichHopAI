<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Reset password - AI Code Learning</title>
  <link rel="stylesheet" th:href="@{/css/forgot_password.css}">
</head>

<body class="forgot-page">

<div class="forgot-wrapper">
  <div class="forgot-card">
    <h1 class="title">Reset password</h1>
    <p class="subtitle">
      System will send OTP via email for you to reset your password
    </p>

    <form th:action="@{/api/auth/forgot-password}" method="post" onsubmit="return validateForgotForm()">

      <div class="form-group">
        <input type="text"
               id="email"
               name="email"
               class="form-control-custom"
               placeholder="Email address"
               autocomplete="off">
      </div>

      <!-- Popup báo lỗi -->
      <div id="error-popup"
           class="popup"
           th:classappend="${error != null} ? '' : ' hidden'">

        <span th:text="${error} "></span>

        <span th:if="${unverifiedEmail != null}">
            <a th:href="@{'/api/auth/resend-register'(email=${unverifiedEmail})}"
               style="color:#660000; text-decoration: underline; cursor:pointer;">Receive verify code to activate your account.
            </a>
        </span>
      </div>

      <div class="btn-row">
        <a href="/login" class="btn-back-to-login">Back</a>
        <button type="submit" class="btn-next">Next</button>
      </div>

    </form>

  </div>
</div>

<script>
  function validateForgotForm() {
    const email = document.getElementById("email");
    const popup = document.getElementById("error-popup");

    const val = email.value.trim();

    // Reset
    email.classList.remove("error-field");
    popup.classList.add("hidden");

    // FE: rỗng
    if (!val) {
      popup.textContent = "Email cannot be empty.";
      popup.classList.remove("hidden");
      email.classList.add("error-field");
      return false;
    }

    // FE: sai format
    if (!val.includes("@")) {
      popup.textContent = "Invalid email format.";
      popup.classList.remove("hidden");
      email.classList.add("error-field");
      return false;
    }

    // FE ok → cho submit lên BE
    return true;
  }

  document.getElementById("email").addEventListener("input", () => {
    const popup = document.getElementById("error-popup");

    // chỉ ẩn nếu popup đang chứa lỗi FE
    if (!popup.hasAttribute("th:text")) {
      popup.classList.add("hidden");
    }

    document.getElementById("email").classList.remove("error-field");
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-whatever"
        crossorigin="anonymous"></script>

</body>
</html>
