<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Checkout - Codemy</title>
    <link rel="stylesheet" th:href="@{/css/student/payment/enroll.css}">
</head>
<body>

<header th:replace="fragments/header :: header(
    loggedIn=${user != null},
    user=${user}
)"></header>

<div class="checkout-wrapper">

    <div class="checkout-left">
        <h2>How would you like to pay?</h2>

        <div class="payment-method active" data-method="momo">
            <img src="/images/momo-logo.png" alt="MoMo">
            <span>MoMo E-Wallet</span>
        </div>

<!--        <div class="payment-method" data-method="banking">-->
<!--            <img src="/images/bank-logo.png" alt="Banking">-->
<!--            <span>Banking QR Scanner</span>-->
<!--        </div>-->
    </div>

    <!-- RIGHT -->
    <div class="checkout-right">
        <div class="order-summary">
            <h3>Order summary</h3>

            <div class="course-info">
                <img th:src="${course.anhBiaKhoaHoc}" alt="Course thumbnail">
                <div class="course-meta">
                    <h4 th:text="${course.tenKhoaHoc}">Course name</h4>
                    <p th:text="${course.moTaKhoaHoc}">
                        Short course description
                    </p>
                </div>
            </div>

            <div class="price-row">
                <span>Course price</span>
                <span class="price"
                      th:text="${#numbers.formatDecimal(course.giaBan,0,'COMMA',0,'POINT')} + ' ₫'">
            </span>
            </div>

            <div class="price-row total">
                <span>Total</span>
                <span class="price"
                      th:text="${#numbers.formatDecimal(course.giaBan,0,'COMMA',0,'POINT')} + ' ₫'">
            </span>
            </div>
        </div>

        <form method="post"
              th:action="@{/enroll/payment}"
              id="paymentForm">

            <input type="hidden" name="courseId"
                   th:value="${course.idKhoaHoc}">

            <input type="hidden" name="paymentMethod"
                   id="paymentMethod" value="momo">

            <input type="hidden" name="amount"
                   th:value="${course.giaBan}">

            <button class="btn-primary full">
                Continue to secure payment
            </button>
        </form>
    </div>


</div>

<script>
    const methods = document.querySelectorAll(".payment-method");
    const paymentInput = document.getElementById("paymentMethod");

    methods.forEach(m => {
        m.addEventListener("click", () => {
            methods.forEach(x => x.classList.remove("active"));
            m.classList.add("active");
            paymentInput.value = m.dataset.method;
        });
    });

    document.getElementById("paymentForm").addEventListener("submit", function (e) {
        const method = paymentInput.value;

        if (method === "banking") {
            this.action = "/enroll/banking";
        } else {
            this.action = "/enroll/payment"; // momo
        }
    });
</script>

</body>
</html>
