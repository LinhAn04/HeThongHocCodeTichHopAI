<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${course.tenKhoaHoc} + ' - Codemy'">Course Detail</title>
    <link rel="stylesheet" th:href="@{/css/student/courses/course_detail.css}">
    <link rel="stylesheet" th:href="@{/css/student/courses/comments.css}">
    <link rel="stylesheet" th:href="@{/css/student/lessons/lessons.css}">

    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>

<header th:replace="fragments/header :: header(loggedIn=${loggedIn}, user=${user})"></header>

<div class="page-container">
    <!-- banner -->
    <section class="hero">
        <img class="hero-bg" th:src="${course.anhBiaKhoaHoc}" alt="bg">
        <div class="hero-content">
            <h1 th:text="${course.tenKhoaHoc}"></h1>
            <p th:text="${course.moTaKhoaHoc}"></p>

            <div class="meta">
                <div><b>Author:</b> <span th:text="${course.tacGia != null ? course.tacGia : 'Codemy team'}"></span></div>
                <div><b>Created:</b> <span th:text="${course.ngayTao != null ? #temporals.format(course.ngayTao, 'dd/MM/yyyy') : '—'}"></span></div>
                <div><b>Price:</b> <span th:text="${course.giaBan}"></span></div>
            </div>
        </div>
        <a class="btn-primary enroll-btn"
                type="button"
                th:href="@{/enroll/{id}(id=${course.idKhoaHoc})}"
                th:if="${loggedIn and dangKy == null}">
            Enroll this course
        </a>
        <a class="btn-primary enroll-btn"
                type="button"
                onclick="openLoginPopup()"
                th:if="${!loggedIn and dangKy == null}">
            Enroll this course
        </a>
    </section>

    <!-- tabs -->
    <div class="tabs">
        <button class="tab-btn"
                type="button"
                data-tab="lessons"
                th:classappend="${openTab=='lessons'} ? 'active' : ''">Lessons</button>
        <button class="tab-btn"
                type="button"
                data-tab="comments"
                th:classappend="${openTab=='comments'} ? 'active' : ''">Comments</button>
    </div>

    <!-- Lessons tab -->
    <div th:replace="fragments/course_detail/lessons :: lessons(
        ${lessons},
        ${tienDo},
        ${unlockedLessonIds}
    )"></div>

    <!-- Comments tab -->
    <div th:replace="fragments/course_detail/comments :: comments(
        ${comments},
        ${repliesMap},
        ${course},
        ${loggedIn}
    )"></div>
</div>

<!-- Edit History Popup -->
<div id="editHistoryOverlay" class="overlay hidden">
    <div class="edit-history-popup">
        <div class="popup-header">
            <span>Edit history</span>
            <button id="closeHistory">✕</button>
        </div>

        <div id="editHistoryContent" class="popup-content">

        </div>

        <div class="popup-footer">
            Edits to comments are visible to everyone who can see this comment.
        </div>
    </div>
</div>

<!-- Delete comments/replies confirm popup -->
<div id="deleteConfirmOverlay" class="overlay hidden">
    <div class="edit-history-popup" style="max-width:420px">
        <div class="popup-header">
            <span id="deleteTitle">Delete</span>
            <button id="closeDelete">✕</button>
        </div>

        <div class="popup-content">
            <p id="deleteMessage" style="line-height:1.5">
                Are you sure you want to delete this?
            </p>
        </div>

        <div class="popup-footer"
             style="display:flex; justify-content:flex-end; gap:10px">

            <button id="cancelDelete"
                    class="menu-item">
                Cancel
            </button>

            <button id="confirmDelete"
                    class="menu-item delete">
                Delete
            </button>
        </div>
    </div>
</div>

<!-- Noti to login if user want to enroll course -->
<div id="popup" class="overlay hidden">
    <div class="popup-box" style="max-width:500px">
        <div class="popup-header">
            <span id="title"></span>
            <button id="closePopup">✕</button>
        </div>

        <div class="popup-content">
            <p id="message" style="line-height:1.5">
                Please log in to your account to enroll in this course and access its learning materials.
            </p>
        </div>

        <div class="popup-footer"
             style="display:flex; justify-content:flex-start">

            <a class="login-link"
               href="/login">
                Go to login
            </a>
        </div>
    </div>
</div>


<script th:src="@{/js/header.js}"></script>
<script th:src="@{/js/course_detail.js}"></script>
<script th:src="@{/js/comments.js}"></script>

</body>
</html>
